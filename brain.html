<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AI Brain</title>
  <style>
    body {
      margin: 0;
      height: 100vh;
      width: 100vw;
      overflow: hidden;
      background: radial-gradient(circle at center, #0f2027, #203a43, #2c5364);
      font-family: Arial, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      color: white;
      flex-direction: column;
    }
    #hint {
      position: absolute;
      bottom: 5%;
      left: 50%;
      transform: translateX(-50%);
      font-size: clamp(0.9rem, 2.5vw, 1.2rem);
      text-align: center;
      background: rgba(0,0,0,0.5);
      padding: 10px 15px;
      border-radius: 10px;
      max-width: 90%;
      box-shadow: 0 0 15px rgba(255,255,255,0.7);
    }
    canvas { display: block; }
  </style>
</head>
<body>
  <div id="hint">üß† Tap the Core to Awaken Intelligence ‚Üí Enter Think Mode</div>

  <script type="importmap">
  {
    "imports": {
      "three": "https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.module.js",
      "three/examples/": "https://cdn.jsdelivr.net/npm/three@0.158.0/examples/jsm/"
    }
  }
  </script>

  <script type="module">
    import * as THREE from 'three';
    import { GLTFLoader } from 'three/examples/loaders/GLTFLoader.js';
    import { OrbitControls } from 'three/examples/controls/OrbitControls.js';
    import { EffectComposer } from 'three/examples/postprocessing/EffectComposer.js';
    import { RenderPass } from 'three/examples/postprocessing/RenderPass.js';
    import { UnrealBloomPass } from 'three/examples/postprocessing/UnrealBloomPass.js';

    let scene, camera, renderer, brain, clock, composer, bloomPass, particleSystem, controls;
    let hoverPulse = 0;

    init();
    animate();

    function init() {
      scene = new THREE.Scene();

      camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 1000);
      camera.position.z = 3.5;

      renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      document.body.appendChild(renderer.domElement);

      controls = new OrbitControls(camera, renderer.domElement);
      controls.enableDamping = true;
      controls.dampingFactor = 0.05;
      controls.autoRotate = true;
      controls.autoRotateSpeed = 0.8;

      const ambient = new THREE.AmbientLight(0xffffff, 0.6);
      scene.add(ambient);

      const pointLight = new THREE.PointLight(0xffffff, 2, 100);
      pointLight.position.set(5, 5, 5);
      scene.add(pointLight);

      const loader = new GLTFLoader();
      loader.load("brain_areas.glb",
        (gltf) => {
          brain = gltf.scene;
          brain.scale.set(1.5, 1.5, 1.5);
          scene.add(brain);
          brain.traverse(node => {
            if (node.isMesh) {
              node.material.color = new THREE.Color(0xffffff);
              node.material.emissive = new THREE.Color(0xffffff);
              node.material.emissiveIntensity = 0.2;
              node.material.transparent = true;
              node.material.opacity = 0.98;
            }
          });
        },
        undefined,
        (error) => console.error("‚ùå Error loading brain model:", error)
      );

      const particles = new THREE.BufferGeometry();
      const particleCount = 1000;
      const positions = new Float32Array(particleCount * 3);
      for (let i = 0; i < particleCount * 3; i++) {
        positions[i] = (Math.random() - 0.5) * 6;
      }
      particles.setAttribute("position", new THREE.BufferAttribute(positions, 3));

      const particleMaterial = new THREE.PointsMaterial({
        color: 0xffffff,
        size: 0.008,
        transparent: true,
        opacity: 0.6
      });

      particleSystem = new THREE.Points(particles, particleMaterial);
      scene.add(particleSystem);

      clock = new THREE.Clock();
      window.addEventListener("resize", onResize);

      const renderScene = new RenderPass(scene, camera);
      bloomPass = new UnrealBloomPass(new THREE.Vector2(window.innerWidth, window.innerHeight), 1.2, 0.8, 0.7);

      composer = new EffectComposer(renderer);
      composer.addPass(renderScene);
      composer.addPass(bloomPass);

      renderer.domElement.addEventListener("mouseenter", () => { hoverPulse = 1; });
      renderer.domElement.addEventListener("click", () => { window.location.href = "/chat.html"; });
    }

    function onResize() {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
      composer.setSize(window.innerWidth, window.innerHeight);
    }

    function animate() {
      requestAnimationFrame(animate);
      const elapsed = clock.getElapsedTime();

      if (brain) {
        if (hoverPulse > 0) {
          bloomPass.strength = 2.0 * hoverPulse;
          hoverPulse -= 0.02;
        } else {
          bloomPass.strength = 1.2 + Math.sin(elapsed * 2) * 0.1;
        }
      }

      if (particleSystem) {
        particleSystem.rotation.y += 0.0008;
        particleSystem.rotation.x += 0.0003;
      }

      controls.update();
      composer.render();
    }
  </script>
</body>
</html>
